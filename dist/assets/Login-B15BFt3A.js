import{m as G,o as R,q,r as g,j as e,v as A,L as C,z as i}from"./index-D7F0MAQ-.js";import{l as B,g as E,s as F}from"./authService-Cd2g1i02.js";import{u as H,a as V,o as O,b as P,s as S}from"./schemas-TicUotkH.js";const J=O({email:S().min(1,"El correo es requerido.").email("Ingresa un correo vÃ¡lido."),password:S().min(6,"La contraseÃ±a debe tener al menos 6 caracteres."),remember:P().optional()});function D(){var y,N;const{setUserData:d}=G()??{},x=R(),b=q(),h=((N=(y=b.state)==null?void 0:y.from)==null?void 0:N.pathname)??"/dashboard",p=g.useRef(!0),[m,k]=g.useState(!1);g.useEffect(()=>()=>{p.current=!1},[]);const{register:f,handleSubmit:z,setValue:j,formState:{errors:c,isSubmitting:I}}=H({resolver:V(J),defaultValues:{email:"",password:"",remember:!0}});g.useEffect(()=>{var r;const s=(r=b.state)==null?void 0:r.providerUser;s!=null&&s.email&&j("email",s.email)},[b.state,j]);const w=s=>{var r;return s?s.user?s.user:(r=s.data)!=null&&r.user?s.data.user:s:null},v=s=>{const r=((s==null?void 0:s.message)||String(s||"")).toLowerCase();return r.includes("wrong-password")||r.includes("invalid login")||r.includes("invalid credentials")?"Correo o contraseÃ±a incorrectos.":r.includes("user not found")||r.includes("no user")?"No existe una cuenta con ese correo.":r.includes("invalid email")?"Correo invÃ¡lido.":r.includes("too many requests")||r.includes("too many")?"Demasiados intentos fallidos. Intenta mÃ¡s tarde.":s!=null&&s.message?s.message:"Error al iniciar sesiÃ³n. Intenta nuevamente."},L=async s=>{if(p.current)try{console.log("Ejecutando login con valores:",s),i.dismiss();const r=i.loading("Iniciando sesiÃ³n..."),t=await B(s.email.trim(),s.password),o=w(t),a=(o==null?void 0:o.id)??(o==null?void 0:o.uid);if(!a)throw new Error("No se obtuvo id del proveedor de autenticaciÃ³n.");const l=await E(a).catch(()=>null);if(d==null||d(l??{id:a,email:o.email}),i.success("SesiÃ³n iniciada",{id:r}),h&&!["/login","/register"].includes(h)){x(h,{replace:!0});return}x((l==null?void 0:l.role)==="editor"?"/dashboard/editor":"/dashboard/reportero",{replace:!0})}catch(r){console.error("Login error:",r);const t=v(r);i.dismiss(),i.error(t)}},M=async()=>{var s;try{i.dismiss();const r=i.loading("Accediendo con Google..."),t=await F(),o=(t==null?void 0:t.url)||((s=t==null?void 0:t.data)==null?void 0:s.url);if(o){window.location.href=o;return}const a=w(t),l=(a==null?void 0:a.id)??(a==null?void 0:a.uid);if(!l)throw new Error("No se obtuvo informaciÃ³n del proveedor.");const u=await E(l).catch(()=>null);d==null||d(u),i.success("Bienvenido/a",{id:r}),x((u==null?void 0:u.role)==="editor"?"/dashboard/editor":"/dashboard/reportero",{replace:!0})}catch(r){console.error("Google sign-in error:",r),i.dismiss(),i.error(v(r))}},n=I;return e.jsx("div",{className:"login-page bg-gradient-to-b from-gray-50 to-gray-100 flex items-center justify-center min-h-screen p-6",children:e.jsx("div",{className:"login-wrapper w-full max-w-md",children:e.jsxs("form",{"data-jdx-login":!0,onSubmit:z(L),className:"login-card bg-white rounded-2xl shadow-lg p-6 relative overflow-hidden","aria-busy":n,children:[n&&e.jsx("div",{className:"login-overlay absolute inset-0 bg-white/75 flex items-center justify-center z-40",children:e.jsx("div",{className:"spinner"})}),e.jsxs("div",{className:"login-header flex items-center gap-3 mb-4",children:[e.jsx("img",{src:A,alt:"JDX News",className:"login-logo w-12 h-12 object-contain rounded-lg"}),e.jsxs("div",{children:[e.jsx("h1",{className:"login-title text-xl font-bold text-gray-900",children:"Inicia sesiÃ³n"}),e.jsx("p",{className:"login-sub text-gray-500 text-sm",children:"Accede al panel de administraciÃ³n"})]})]}),c.root&&e.jsx("div",{role:"alert",className:"login-error bg-red-50 border border-red-200 text-red-700 rounded-md p-3 mb-3 text-sm",children:c.root.message}),e.jsx("label",{htmlFor:"email",className:"block font-semibold text-gray-700 mb-1",children:"Correo electrÃ³nico"}),e.jsx("input",{id:"email",type:"email",placeholder:"tu@ejemplo.com",disabled:n,className:"login-input w-full border border-gray-300 rounded-md p-2.5 focus:ring-2 focus:ring-teal-400 outline-none mb-3",...f("email")}),c.email&&e.jsx("p",{className:"text-sm text-red-600 mb-2",children:c.email.message}),e.jsx("label",{htmlFor:"password",className:"block font-semibold text-gray-700 mb-1",children:"ContraseÃ±a"}),e.jsxs("div",{className:"login-password-row flex items-center gap-2 mb-4",children:[e.jsx("input",{id:"password",type:m?"text":"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",disabled:n,className:"login-input-password flex-1 border border-gray-300 rounded-md p-2.5 focus:ring-2 focus:ring-teal-400 outline-none",...f("password")}),e.jsx("button",{type:"button",className:"btn-icon",onClick:()=>k(s=>!s),"aria-pressed":m,"aria-label":m?"Ocultar contraseÃ±a":"Mostrar contraseÃ±a",disabled:n,children:m?"ğŸ‘ï¸â€ğŸ—¨ï¸":"ğŸ‘ï¸"})]}),c.password&&e.jsx("p",{className:"text-sm text-red-600 mb-2",children:c.password.message}),e.jsxs("div",{className:"login-row flex justify-between items-center mb-4 text-sm text-gray-600",children:[e.jsxs("label",{className:"checkbox-label inline-flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",disabled:n,...f("remember")}),e.jsx("span",{children:"RecuÃ©rdame"})]}),e.jsx(C,{to:"/forgot-password",className:"link-muted hover:underline",children:"Â¿Olvidaste tu contraseÃ±a?"})]}),e.jsx("button",{type:"submit",disabled:n,className:"btn-primary w-full bg-teal-500 hover:bg-teal-600 text-white font-semibold rounded-md py-2.5 transition",children:n?"Ingresando...":"Entrar"}),e.jsxs("div",{className:"login-divider flex items-center gap-3 my-4",children:[e.jsx("div",{className:"flex-1 h-px bg-gray-200"}),e.jsx("span",{className:"login-divider-content text-gray-400 text-sm",children:"o"}),e.jsx("div",{className:"flex-1 h-px bg-gray-200"})]}),e.jsxs("button",{type:"button",onClick:M,disabled:n,className:"btn-google w-full border border-gray-300 bg-white rounded-md py-2.5 flex items-center justify-center gap-2 text-gray-800 font-medium hover:bg-gray-50 transition",children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 533.5 544.3","aria-hidden":"true",children:[e.jsx("path",{fill:"#4285f4",d:"M533.5 278.4c0-17.7-1.6-35.4-4.8-52.5H272v99.4h146.9c-6.4 34.9-26.1 64.4-55.6 84.2v69.9h89.6c52.4-48.3 82.6-119.5 82.6-200.9z"}),e.jsx("path",{fill:"#34a853",d:"M272 544.3c73.6 0 135.5-24.4 180.7-66.5l-89.6-69.9c-24.9 16.7-56.6 26.5-91.1 26.5-69.9 0-129.2-47.2-150.4-110.5H31.6v69.5C76.2 487 168.6 544.3 272 544.3z"}),e.jsx("path",{fill:"#fbbc04",d:"M121.6 327.9c-11.7-34.9-11.7-72.6 0-107.5V150.9H31.6c-39.3 78.3-39.3 171.6 0 249.9l90-72.9z"}),e.jsx("path",{fill:"#ea4335",d:"M272 109.7c38.9-.6 76.5 14.2 104.9 40.8l78.6-78.6C408.1 24.1 344.7-.2 272 0 168.6 0 76.2 57.3 31.6 150.9l90 69.5C142.8 157 202.1 109.7 272 109.7z"})]}),e.jsx("span",{children:"Continuar con Google"})]}),e.jsxs("div",{className:"login-footer text-center text-gray-600 text-sm mt-4",children:["Â¿No tienes cuenta?"," ",e.jsx(C,{to:"/register",className:"link-strong text-teal-600 font-semibold hover:underline",children:"RegÃ­strate"})]})]})})})}export{D as default};
