import{w as n}from"./index-D7F0MAQ-.js";async function u(e,t="news"){if(!e)return null;const r=`${Date.now()}_${e.name.replace(/\s+/g,"_")}`,a=`${t}/${r}`,{error:s}=await n.storage.from("news-images").upload(a,e);if(s)throw s;const{data:o}=n.storage.from("news-images").getPublicUrl(a);return{url:o.publicUrl,path:a}}function i(e){return e?{id:e.id,title:e.title,subtitle:e.subtitle,content:e.content,category:e.category,imageUrl:e.image_url||"",imagePath:e.image_path||"",author:e.author,status:e.status,createdAt:e.created_at,updatedAt:e.updated_at}:null}async function l(e){const{data:{user:t},error:r}=await n.auth.getUser();if(r)throw r;if(!t)throw new Error("Debes iniciar sesión para crear noticias");const a={title:e.title||"",subtitle:e.subtitle||"",content:e.content||"",category:e.category||"General",image_url:e.imageUrl||"",image_path:e.imagePath||"",author:t.id,status:e.status||"Edición",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:s,error:o}=await n.from("news").insert([a]).select().single();if(o)throw o;return i(s)}async function g(e=null){let t=n.from("news").select("*").order("created_at",{ascending:!1});e&&(t=t.eq("status",e));const{data:r,error:a}=await t;if(a)throw a;return Array.isArray(r)?r.map(i):[]}async function f(e){const{data:t,error:r}=await n.from("news").select("*").eq("id",e).single();if(r)throw r;return i(t)}async function w(e,t){const r={title:t.title,subtitle:t.subtitle,content:t.content,category:t.category,image_url:t.imageUrl,image_path:t.imagePath,author:t.author,status:t.status,updated_at:new Date().toISOString()},{error:a}=await n.from("news").update(r).eq("id",e);if(a)throw a}async function m(e,t){const{error:r}=await n.from("news").update({status:t,updated_at:new Date().toISOString()}).eq("id",e);if(r)throw r}async function d(e,t){if(t){const{error:a}=await n.storage.from("news-images").remove([t]);a&&console.warn("Error eliminando imagen:",a)}const{error:r}=await n.from("news").delete().eq("id",e);if(r)throw r}async function p(e){if(!e)return;const{error:t}=await n.storage.from("news-images").remove([e]);if(t)throw t}async function h(e,t=null){let r=n.from("news").select("*").eq("author",e).order("created_at",{ascending:!1});t&&(r=r.eq("status",t));const{data:a,error:s}=await r;if(s)throw s;return Array.isArray(a)?a.map(i):[]}export{f as a,w as b,l as c,p as d,h as e,d as f,g,m as h,u};
