import{m as I,o as M,q as k,r as b,j as e,L as V,z as t}from"./index-D7F0MAQ-.js";import{u as H,a as q,o as O,s as j}from"./schemas-TicUotkH.js";import{g as S,a as v,r as P,s as _}from"./authService-Cd2g1i02.js";const A=O({name:j().min(1,"El nombre es obligatorio."),email:j().min(1,"El correo es requerido.").email("Ingresa un correo válido."),password:j().min(6,"La contraseña debe tener al menos 6 caracteres.").optional()});function Y(){var E,C;const{setUserData:m}=I()??{},w=M(),y=k(),a=((E=y.state)==null?void 0:E.providerUser)??null,N=((C=y.state)==null?void 0:C.from)??"/dashboard/reportero",h=b.useRef(!0);b.useEffect(()=>()=>h.current=!1,[]);const{register:f,handleSubmit:z,setValue:x,formState:{errors:i,isSubmitting:n}}=H({resolver:q(A),defaultValues:{name:(a==null?void 0:a.displayName)??"",email:(a==null?void 0:a.email)??"",password:""}});b.useEffect(()=>{a&&(x("name",a.displayName??""),x("email",a.email??""))},[a,x]);const D=r=>{const l=r&&(r.code||r.message)||String(r||"");return/email-already-in-use/i.test(l)?"El correo ya está registrado. Intenta iniciar sesión.":/invalid-email/i.test(l)?"Correo inválido.":/weak-password/i.test(l)?"La contraseña es débil. Usa al menos 6 caracteres.":(r==null?void 0:r.message)??"Error al crear la cuenta. Intenta de nuevo."},G=async r=>{var l,R;if(h.current){t.dismiss(),console.log("Ejecutando registro con valores:",r);try{const g=t.loading(a?"Finalizando registro...":"Creando cuenta...");if(a!=null&&a.uid||a!=null&&a.id){const o=a.uid??a.id;let d=null;try{d=await S(o)}catch(p){console.error("getUserData error:",p)}if(!d){const p={id:o,name:r.name.trim(),email:r.email.trim(),photoURL:a.photoURL??null,role:"reportero",provider:"google",created_at:new Date().toISOString()};await v(o,p),d=p}typeof m=="function"&&m(d),t.success("Registro completado",{id:g}),w(N,{replace:!0});return}if(!r.password||r.password.length<6){t.error("La contraseña debe tener al menos 6 caracteres.");return}const F=t.loading("Creando cuenta..."),s=await P(r.email.trim(),r.password,r.name.trim()),c=(s==null?void 0:s.id)??((l=s==null?void 0:s.user)==null?void 0:l.id)??(s==null?void 0:s.uid)??((R=s==null?void 0:s.user)==null?void 0:R.uid)??null;let u=null;if(c)try{u=await S(c)}catch(o){console.error("getUserData after register error:",o)}if(!u&&c){const o={id:c,name:r.name.trim(),email:r.email.trim(),role:"reportero",created_at:new Date().toISOString()};try{await v(c,o),u=o}catch(d){console.error("saveUserData error:",d)}}typeof m=="function"&&m(u??{id:c,email:r.email.trim(),name:r.name.trim()}),t.success("Cuenta creada",{id:F}),w(N,{replace:!0})}catch(g){console.error("Register error:",g),t.error(D(g))}}},L=async()=>{if(h.current){t.dismiss();try{const r=t.loading("Redirigiendo a Google...");await _(),t.success("Continúa con Google",{id:r})}catch(r){console.error("Google register error:",r),t.error((r==null?void 0:r.message)??"Error al registrarse con Google.")}}};return e.jsx("div",{className:"register-page",children:e.jsxs("div",{className:"register-card",role:"region","aria-labelledby":"register-title",children:[e.jsx("h2",{id:"register-title",className:"register-title",children:"Registro"}),a&&e.jsx("div",{className:"register-note",role:"status","aria-live":"polite",children:"Se detectaron datos desde Google. Completa o confirma tu perfil para crear tu cuenta."}),i.root&&e.jsx("div",{className:"register-error",role:"alert",children:i.root.message}),e.jsxs("form",{onSubmit:z(G),noValidate:!0,children:[e.jsx("label",{htmlFor:"name",children:"Nombre completo"}),e.jsx("input",{id:"name",...f("name"),className:"register-input",disabled:n}),i.name&&e.jsx("p",{className:"text-sm text-red-600 mb-2",children:i.name.message}),e.jsx("label",{htmlFor:"email",children:"Correo electrónico"}),e.jsx("input",{id:"email",...f("email"),className:"register-input",disabled:n}),i.email&&e.jsx("p",{className:"text-sm text-red-600 mb-2",children:i.email.message}),!a&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"password",children:"Contraseña"}),e.jsx("input",{id:"password",...f("password"),type:"password",className:"register-input",disabled:n}),i.password&&e.jsx("p",{className:"text-sm text-red-600 mb-2",children:i.password.message})]}),e.jsx("button",{type:"submit",className:"register-btn-primary",disabled:n,children:n?"Procesando...":a?"Finalizar registro":"Registrarse"})]}),e.jsx("div",{className:"register-divider","aria-hidden":"true",children:e.jsx("span",{children:"o"})}),e.jsxs("button",{type:"button",className:"register-btn-google",onClick:L,disabled:n,children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 533.5 544.3","aria-hidden":"true",focusable:"false",children:[e.jsx("path",{fill:"#4285f4",d:"M533.5 278.4c0-17.7-1.6-35.4-4.8-52.5H272v99.4h146.9c-6.4 34.9-26.1 64.4-55.6 84.2v69.9h89.6c52.4-48.3 82.6-119.5 82.6-200.9z"}),e.jsx("path",{fill:"#34a853",d:"M272 544.3c73.6 0 135.5-24.4 180.7-66.5l-89.6-69.9c-24.9 16.7-56.6 26.5-91.1 26.5-69.9 0-129.2-47.2-150.4-110.5H31.6v69.5C76.2 487 168.6 544.3 272 544.3z"}),e.jsx("path",{fill:"#fbbc04",d:"M121.6 327.9c-11.7-34.9-11.7-72.6 0-107.5V150.9H31.6c-39.3 78.3-39.3 171.6 0 249.9l90-72.9z"}),e.jsx("path",{fill:"#ea4335",d:"M272 109.7c38.9-.6 76.5 14.2 104.9 40.8l78.6-78.6C408.1 24.1 344.7-.2 272 0 168.6 0 76.2 57.3 31.6 150.9l90 69.5C142.8 157 202.1 109.7 272 109.7z"})]}),e.jsx("span",{children:n?"Procesando...":"Continuar con Google"})]}),e.jsxs("div",{className:"register-footer",children:["¿Ya tienes cuenta?"," ",e.jsx(V,{to:"/login",className:"register-link",children:"Inicia sesión"})]})]})})}export{Y as default};
